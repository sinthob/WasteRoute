<h2 mat-dialog-title>เลือกพนักงานขับรถ</h2>

<mat-dialog-content>
  <div class="search-container">
    <mat-form-field appearance="outline" class="search-field">
      <mat-icon matPrefix>search</mat-icon>
      <input
        matInput
        placeholder="ค้นหาชื่อหรือเบอร์โทร"
        (input)="onSearchChange($any($event.target).value)"
        [value]="searchText()"
      />
    </mat-form-field>
  </div>

  @if (loading()) {
  <div class="loading-container">
    <mat-spinner diameter="48"></mat-spinner>
  </div>
  } @if (!loading()) { @if (filteredDrivers().length === 0) {
  <div class="empty-state">
    <mat-icon>person_off</mat-icon>
    <p>ไม่พบพนักงานขับรถ</p>
  </div>
  } @else {
  <div class="table-container">
    <table mat-table [dataSource]="filteredDrivers()" class="driver-table">
      <!-- Select Column -->
      <ng-container matColumnDef="select">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let driver">
          <mat-icon
            class="select-icon"
            [class.selected]="isSelected(driver)"
            (click)="selectDriver(driver)"
          >
            {{
              isSelected(driver)
                ? "radio_button_checked"
                : "radio_button_unchecked"
            }}
          </mat-icon>
        </td>
      </ng-container>

      <!-- Code Column -->
      <ng-container matColumnDef="code">
        <th mat-header-cell *matHeaderCellDef>รหัสพนักงาน</th>
        <td mat-cell *matCellDef="let driver">
          {{ staffCode(driver.id) }}
          @if (isCurrent(driver)) {
          <span class="current-badge">ปัจจุบัน</span>
          }
        </td>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>ชื่อ-นามสกุล</th>
        <td mat-cell *matCellDef="let driver">
          {{ driver.prefix }} {{ driver.firstname }} {{ driver.lastname }}
        </td>
      </ng-container>

      <!-- Role Column -->
      <ng-container matColumnDef="role">
        <th mat-header-cell *matHeaderCellDef>ตำแหน่ง</th>
        <td mat-cell *matCellDef="let driver">
          <span class="role-badge">พนักงานขับรถ</span>
        </td>
      </ng-container>

      <!-- Phone Column -->
      <ng-container matColumnDef="phone">
        <th mat-header-cell *matHeaderCellDef>เบอร์โทร</th>
        <td mat-cell *matCellDef="let driver">
          {{ driver.phone_number || "-" }}
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns"
        [class.selected-row]="isSelected(row)"
        (click)="selectDriver(row)"
      ></tr>
    </table>
  </div>
  } }
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="cancel()">ยกเลิก</button>
  <button
    mat-flat-button
    color="primary"
    (click)="confirm()"
    [disabled]="!selectedDriver()"
  >
    ยืนยัน
  </button>
</mat-dialog-actions>
